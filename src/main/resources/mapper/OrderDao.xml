<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.muma.dao.OrderDao">

	<insert id="addOrder">
		INSERT INTO
		tbl_order(task_order_id,type,player_phone,business_phone,shop,shop_id,order_no,money,fee,
		          status,auth_image_one,auth_image_two,remark,create_by,create_time)
		VALUES
		(#{taskOrderId},#{type},#{playerPhone},#{businessPhone},#{shop},#{shopId},#{orderNo},#{fee}
		#{status},#{authImageOne},#{authImageTwo},#{remark},#{createBy},now())
	</insert>
	<select id="queryByShopId" resultType="com.muma.entity.Order">
		SELECT player_phone,shop,shop_id,status,create_time
		FROM tbl_order
		WHERE shop_id= #{shopId}
        AND  player_phone = #{buyerPhone}
        AND status IN (60,90)
		ORDER BY create_time DESC
		limit 1
	</select>
	<select id="queryNotFinishToday" resultType="com.muma.entity.Order">
		SELECT id,shop,type,status,create_time
		FROM tbl_order
		WHERE player_phone = #{buyerPhone}
		AND status IN (0,10,20,40)
        AND type IN (0,1,2,4)
	</select>
	<select id="queryNot20Status" resultType="com.muma.entity.Order">
		SELECT id,shop,type,status,create_time
		FROM tbl_order
		WHERE player_phone = #{buyerPhone}
		AND status IN (0,10)
		AND type = 3
        AND to_days(create_time) = to_days(now())
	</select>
	<select id="queryNotFinishTomorrow" resultType="com.muma.entity.Order">
		SELECT id,shop,type,status,create_time
		FROM tbl_order
		WHERE player_phone = #{buyerPhone}
		AND status IN (0,10,20,40)
		AND type = 3
		AND to_days(now()) - to_days(create_time) &lt;= 1
	</select>
	<select id="queryFinishToday" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM tbl_order
		WHERE player_phone = #{buyerPhone}
		AND status IN (30,40,60,90)
		AND to_days(create_time) = to_days(now())
	</select>
	<select id="queryFinish7Days" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM tbl_order
		WHERE player_phone = #{buyerPhone}
		AND status IN (30,40,60,90)
		AND DATE_SUB(CURDATE(), INTERVAL 7 DAY) &lt;= create_time
	</select>
	<select id="queryFinish30Days" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM tbl_order
		WHERE player_phone = #{buyerPhone}
		  AND status IN (30,40,60,90)
		  AND DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= create_time
	</select>
</mapper>